<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seller Catalog | HomeHaven</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="../css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f1ed;
      min-height: 100vh;
    }
    .seller-header {
      background: linear-gradient(135deg, #8B5C2A 0%, #A67C52 100%);
      color: white;
      padding: 40px 20px;
      text-align: center;
      margin-bottom: 30px;
    }
    .seller-info {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 2px 12px rgba(139, 92, 42, 0.08);
    }
    .seller-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #e3dbd1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      color: #7a6242;
      margin: 0 auto 15px;
    }
    .product-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(139, 92, 42, 0.08);
      transition: transform 0.2s, box-shadow 0.2s;
      border: 1px solid #e5e0da;
      height: 100%;
    }
    .product-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(139, 92, 42, 0.15);
    }
    .product-image {
      position: relative;
      height: 200px;
      overflow: hidden;
    }
    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }
    .product-card:hover .product-image img {
      transform: scale(1.05);
    }
    .product-content {
      padding: 16px;
    }
    .product-category {
      color: #8B5C2A;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .product-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
      line-height: 1.3;
    }
    .product-description {
      color: #666;
      font-size: 0.9rem;
      line-height: 1.5;
      margin-bottom: 12px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .product-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
    }
    .product-price {
      font-size: 1.2rem;
      font-weight: 700;
      color: #8B5C2A;
    }
    .product-stock {
      font-size: 0.85rem;
      font-weight: 500;
      padding: 4px 8px;
      border-radius: 12px;
    }
    .stock-available {
      color: #27ae60;
      background: #d5f4e6;
    }
    .stock-low {
      color: #f39c12;
      background: #fef5e7;
    }
    .stock-out {
      color: #e74c3c;
      background: #fadbd8;
    }
    .search-filters {
      background: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 2px 12px rgba(139, 92, 42, 0.08);
    }
    .loading-spinner {
      display: none;
      text-align: center;
      padding: 40px;
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #8B5C2A;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .no-products {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }
    .no-products i {
      font-size: 4rem;
      color: #ddd;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div id="header"></div>
  <script>$(function(){$('#header').load('../header.html');});</script>
  
  <!-- Seller Header -->
  <div class="seller-header">
    <div class="container">
      <h1 id="sellerName">Seller Store</h1>
      <p class="lead">Browse products from this seller</p>
    </div>
  </div>

  <!-- Seller Info -->
  <div class="container">
    <div class="seller-info">
      <div class="row align-items-center">
        <div class="col-md-3 text-center">
          <div class="seller-avatar" id="sellerAvatar">
            <i class="fas fa-store"></i>
          </div>
        </div>
        <div class="col-md-9">
          <h3 id="sellerBusinessName">Seller Business Name</h3>
          <p id="sellerDescription" class="text-muted">Business description will appear here</p>
          <div class="row">
            <div class="col-md-4">
              <small class="text-muted">üìç <span id="sellerAddress">Address</span></small>
            </div>
            <div class="col-md-4">
              <small class="text-muted">üìû <span id="sellerPhone">Phone</span></small>
            </div>
            <div class="col-md-4">
              <small class="text-muted">üìß <span id="sellerEmail">Email</span></small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Search and Filters -->
    <div class="search-filters">
      <div class="row">
        <div class="col-md-6">
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-search"></i></span>
            <input type="text" class="form-control" id="searchInput" placeholder="Search products...">
          </div>
        </div>
        <div class="col-md-3">
          <select class="form-select" id="categoryFilter">
            <option value="">All Categories</option>
          </select>
        </div>
        <div class="col-md-3">
          <select class="form-select" id="sortFilter">
            <option value="name">Sort by Name</option>
            <option value="price_low">Price: Low to High</option>
            <option value="price_high">Price: High to Low</option>
            <option value="newest">Newest First</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Products Grid -->
    <div class="row" id="productsGrid">
      <!-- Products will be loaded here -->
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
      <div class="spinner"></div>
      <p class="mt-3">Loading products...</p>
    </div>

    <!-- No Products Message -->
    <div class="no-products" id="noProducts" style="display: none;">
      <i class="fas fa-box-open"></i>
      <h4>No products found</h4>
      <p>This seller hasn't posted any products yet.</p>
    </div>

    <!-- Load More Button -->
    <div class="text-center mt-4" id="loadMoreContainer" style="display: none;">
      <button class="btn btn-outline-primary" id="loadMoreBtn">
        <i class="fas fa-plus me-2"></i>Load More Products
      </button>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:4000/api/v1';
    let currentPage = 1;
    let allProducts = [];
    let filteredProducts = [];
    let sellerId = null;
    
    // Get seller ID from URL parameter
    function getSellerIdFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('seller_id');
    }
    
    // Load seller information
    async function loadSellerInfo() {
      try {
        const sellerId = getSellerIdFromURL();
        if (!sellerId) {
          alert('No seller ID provided');
          return;
        }
        
        const response = await $.get(`${API_BASE}/sellers/${sellerId}`);
        if (response.success && response.seller) {
          const seller = response.seller;
          
          $('#sellerName').text(seller.business_name || 'Seller Store');
          $('#sellerBusinessName').text(seller.business_name || 'Seller Business');
          $('#sellerDescription').text(seller.business_description || 'No description available');
          $('#sellerAddress').text(seller.business_address || 'Address not provided');
          $('#sellerPhone').text(seller.business_phone || 'Phone not provided');
          $('#sellerEmail').text(seller.business_email || 'Email not provided');
          
          // Update page title
          document.title = `${seller.business_name} - HomeHaven`;
        }
      } catch (error) {
        console.error('Error loading seller info:', error);
      }
    }
    
    // Load seller products
    async function loadSellerProducts(page = 1, append = false) {
      try {
        const sellerId = getSellerIdFromURL();
        if (!sellerId) return;
        
        $('#loadingSpinner').show();
        $('#noProducts').hide();
        
        const response = await $.get(`${API_BASE}/sellers/${sellerId}/products?page=${page}`);
        
        if (response.success && response.products) {
          const products = response.products;
          
          if (page === 1) {
            allProducts = products;
          } else {
            allProducts = allProducts.concat(products);
          }
          
          filteredProducts = [...allProducts];
          
          if (append) {
            renderProducts(products, true);
          } else {
            renderProducts(filteredProducts);
          }
          
          // Show/hide load more button
          if (products.length >= 12) { // Assuming 12 products per page
            $('#loadMoreContainer').show();
          } else {
            $('#loadMoreContainer').hide();
          }
          
          // Load categories for filter
          if (page === 1) {
            loadCategories();
          }
        } else {
          if (page === 1) {
            $('#noProducts').show();
          }
        }
      } catch (error) {
        console.error('Error loading products:', error);
        if (page === 1) {
          $('#noProducts').show();
        }
      } finally {
        $('#loadingSpinner').hide();
      }
    }
    
    // Load categories for filter
    async function loadCategories() {
      try {
        const response = await $.get(`${API_BASE}/products/categories`);
        if (response.success && response.categories) {
          const categoryFilter = $('#categoryFilter');
          response.categories.forEach(category => {
            categoryFilter.append(`<option value="${category.category_id}">${category.name}</option>`);
          });
        }
      } catch (error) {
        console.error('Error loading categories:', error);
      }
    }
    
    // Render products
    function renderProducts(products, append = false) {
      const grid = $('#productsGrid');
      
      if (!append) {
        grid.empty();
      }
      
      if (products.length === 0) {
        if (!append) {
          $('#noProducts').show();
        }
        return;
      }
      
      $('#noProducts').hide();
      
      products.forEach(product => {
        const productCard = createProductCard(product);
        grid.append(productCard);
      });
    }
    
    // Create product card
    function createProductCard(product) {
      const stockQuantity = parseInt(product.stock_quantity || product.stock || 0);
      const stockClass = stockQuantity === 0 ? 'stock-out' : stockQuantity <= 10 ? 'stock-low' : 'stock-available';
      const stockText = stockQuantity === 0 ? 'Out of Stock' : stockQuantity <= 10 ? `Only ${stockQuantity} left` : 'In Stock';
      
      let imageHtml = '';
      if (product.image) {
        let imgSrc = '';
        try {
          const imgs = typeof product.image === 'string' ? JSON.parse(product.image) : product.image;
          imgSrc = Array.isArray(imgs) ? imgs[0] : imgs;
        } catch (e) { 
          imgSrc = product.image; 
        }
        
        if (imgSrc) {
          const imagePath = imgSrc.startsWith('http') ? imgSrc : `http://localhost:4000${imgSrc}`;
          imageHtml = `<img src="${imagePath}" alt="${product.name}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">`;
        }
      }
      
      if (!imageHtml) {
        imageHtml = `<div class="product-image-placeholder" style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f8f5f2; color: #8B5C2A; font-size: 3rem; opacity: 0.3;"><i class="fas fa-couch"></i></div>`;
      }
      
      return `
        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
          <div class="product-card">
            <div class="product-image">
              ${imageHtml}
            </div>
            <div class="product-content">
              <div class="product-category">${product.category_name || 'Uncategorized'}</div>
              <h3 class="product-title">${product.name}</h3>
              <p class="product-description">${product.description || 'No description available'}</p>
              <div class="product-meta">
                <div class="product-price">‚Ç±${parseFloat(product.sell_price).toLocaleString()}</div>
                <div class="product-stock ${stockClass}">${stockText}</div>
              </div>
              <div class="mt-3">
                <button class="btn btn-primary btn-sm w-100" onclick="addToCart(${product.item_id})">
                  <i class="fas fa-cart-plus me-2"></i>Add to Cart
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    // Add to cart function
    function addToCart(itemId) {
      // Check if user is logged in
      const token = localStorage.getItem('jwt_token');
      if (!token) {
        alert('Please log in to add items to cart');
        return;
      }
      
      // Add to cart logic here
      console.log('Adding item to cart:', itemId);
      // You can implement the actual add to cart functionality
    }
    
    // Filter and search products
    function filterProducts() {
      const searchTerm = $('#searchInput').val().toLowerCase();
      const categoryFilter = $('#categoryFilter').val();
      const sortFilter = $('#sortFilter').val();
      
      filteredProducts = allProducts.filter(product => {
        const matchesSearch = product.name.toLowerCase().includes(searchTerm) || 
                            product.description.toLowerCase().includes(searchTerm);
        const matchesCategory = !categoryFilter || product.category_id == categoryFilter;
        
        return matchesSearch && matchesCategory;
      });
      
      // Sort products
      switch (sortFilter) {
        case 'price_low':
          filteredProducts.sort((a, b) => parseFloat(a.sell_price) - parseFloat(b.sell_price));
          break;
        case 'price_high':
          filteredProducts.sort((a, b) => parseFloat(b.sell_price) - parseFloat(a.sell_price));
          break;
        case 'newest':
          filteredProducts.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
          break;
        default:
          filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
      }
      
      renderProducts(filteredProducts);
    }
    
    // Event listeners
    $(document).ready(function() {
      // Load initial data
      loadSellerInfo();
      loadSellerProducts();
      
      // Search and filter events
      $('#searchInput').on('input', filterProducts);
      $('#categoryFilter').on('change', filterProducts);
      $('#sortFilter').on('change', filterProducts);
      
      // Load more button
      $('#loadMoreBtn').on('click', function() {
        currentPage++;
        loadSellerProducts(currentPage, true);
      });
    });
  </script>
</body>
</html> 