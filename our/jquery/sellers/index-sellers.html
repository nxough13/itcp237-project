<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seller Dashboard | HomeHaven</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="../css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
    }
    .dashboard-header {
      background: linear-gradient(135deg, #8B5C2A 0%, #A67C52 100%);
      color: white;
      padding: 28px 12px 18px 12px;
      border-radius: 0 0 1rem 1rem;
      margin-bottom: 2rem;
      text-align: center;
      box-shadow: 0 4px 16px rgba(139, 92, 42, 0.18);
    }
    .card {
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(139,92,42,0.07);
      background: white;
      border: none;
    }
    .card-title {
      color: #8B5C2A;
      font-weight: 600;
    }
    .chart-container {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 8px rgba(139,92,42,0.07);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .chart-container canvas {
      max-width: 400px;
      max-height: 300px;
      width: 100% !important;
      height: auto !important;
    }
    .table-responsive {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(139,92,42,0.07);
    }
    .loading-spinner {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
    }
    .spinner {
      width: 36px;
      height: 36px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #8B5C2A;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .stat-value {
      font-size: 2.2rem;
      color: #A67C52;
      font-weight: 700;
    }
    .stat-label {
      color: #8B5C2A;
      font-size: 1.1rem;
      font-weight: 500;
    }
    .table thead th {
      color: #8B5C2A;
      font-weight: 600;
    }
    .table-striped > tbody > tr:nth-of-type(odd) {
      background-color: #f5f7fa;
    }
  </style>
</head>
<body>
  <div id="header"></div>
  <script>$(function(){$('#header').load('../header.html');});</script>
  <div class="dashboard-header">
    <h1>Welcome, <span id="sellerName">Seller</span>!</h1>
    <p class="lead">Your business overview and analytics</p>
    <div style="margin-top: 20px; text-align: center;">
      <button id="generateReportBtn" class="btn" style="background: #fff; color: #8B5C2A; border: 3px solid #8B5C2A; font-weight: 700; padding: 15px 30px; font-size: 18px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: all 0.3s ease;">
        <i class="fas fa-download me-2"></i>ðŸ“Š Generate Sales Report
      </button>
    </div>
  </div>
  <div class="loading-spinner"><div class="spinner"></div></div>
  
  <!-- Sales Report Preview Modal -->
  <div class="modal fade" id="salesReportModal" tabindex="-1" aria-labelledby="salesReportModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="salesReportModalLabel">Sales Report Preview</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="reportPreviewContent">
          <!-- Report content will be loaded here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="downloadReportBtn">
            <i class="fas fa-download me-2"></i>Download PDF
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <div class="container">
    <div class="row mb-4">
      <div class="col-md-4">
        <div class="card text-center">
          <div class="card-body">
            <div class="stat-label">Total Products</div>
            <div class="stat-value" id="totalProducts">0</div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card text-center">
          <div class="card-body">
            <div class="stat-label">Total Orders</div>
            <div class="stat-value" id="totalOrders">0</div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card text-center">
          <div class="card-body">
            <div class="stat-label">Most Ordered Product</div>
            <div class="stat-value" id="mostOrderedProduct">-</div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <div class="chart-container">
          <h5 style="color:#8B5C2A;">Orders per Product</h5>
          <canvas id="barChart"></canvas>
        </div>
      </div>
      <div class="col-md-6">
        <div class="chart-container">
          <h5 style="color:#8B5C2A;">Orders Over Time</h5>
          <canvas id="lineChart"></canvas>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div class="chart-container">
          <h5 style="color:#8B5C2A;">Product Category Distribution</h5>
          <canvas id="pieChart"></canvas>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div class="table-responsive mt-4">
          <h5 style="color:#8B5C2A;">Recent Orders</h5>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Order #</th>
                <th>Product</th>
                <th>Customer</th>
                <th>Quantity</th>
                <th>Status</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody id="recentOrdersTable">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <script>
    const API_BASE = 'http://localhost:4000/api/v1'; // Updated to match backend route prefix
    // Show/hide loading spinner
    function showLoading() { $('.loading-spinner').show(); }
    function hideLoading() { $('.loading-spinner').hide(); }
    // Get JWT token from localStorage (adjust if you use cookies/session)
    function getToken() { return localStorage.getItem('jwt_token'); }
    // Set up AJAX with token
    $.ajaxSetup({
      beforeSend: function(xhr) {
        const token = getToken();
        if (token) xhr.setRequestHeader('Authorization', 'Bearer ' + token);
      }
    });
    // Fetch and render dashboard data
    async function loadDashboard() {
      showLoading();
      try {
        // 1. Fetch seller products
        const productsRes = await $.get(API_BASE + '/seller/products');
        const products = productsRes.products || [];
        $('#totalProducts').text(products.length);
        // 2. Fetch seller orders
        const ordersRes = await $.get(API_BASE + '/seller/orders');
        const orders = ordersRes.orders || [];
        $('#totalOrders').text(orders.length);
        // 3. Seller name (from first product or fallback)
        let sellerName = 'Seller';
        if (products.length > 0 && products[0].seller_id_name) sellerName = products[0].seller_id_name;
        else if (orders.length > 0 && orders[0].product_name) sellerName = orders[0].product_name;
        $('#sellerName').text(sellerName);
        // 4. Most ordered product
        const productOrderCounts = {};
        orders.forEach(o => {
          productOrderCounts[o.product_name] = (productOrderCounts[o.product_name] || 0) + o.quantity;
        });
        let mostOrdered = '-';
        let maxOrders = 0;
        Object.entries(productOrderCounts).forEach(([name, count]) => {
          if (count > maxOrders) { mostOrdered = name; maxOrders = count; }
        });
        $('#mostOrderedProduct').text(mostOrdered);
        // 5. Orders per product (bar chart)
        const barLabels = Object.keys(productOrderCounts);
        const barData = Object.values(productOrderCounts);
        // 6. Orders over time (line chart)
        const ordersByMonth = {};
        orders.forEach(o => {
          const d = new Date(o.date_placed);
          const label = d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0');
          ordersByMonth[label] = (ordersByMonth[label] || 0) + o.quantity;
        });
        const lineLabels = Object.keys(ordersByMonth).sort();
        const lineData = lineLabels.map(l => ordersByMonth[l]);
        // 7. Product category distribution (pie chart)
        // We'll need to fetch categories and map product to category
        const catRes = await $.get(API_BASE + '/seller/categories');
        const categories = catRes.categories || [];
        const catMap = {};
        categories.forEach(c => { catMap[c.category_id] = c.name; });
        const catCounts = {};
        products.forEach(p => {
          const cat = catMap[p.category_id] || 'Uncategorized';
          catCounts[cat] = (catCounts[cat] || 0) + 1;
        });
        const pieLabels = Object.keys(catCounts);
        const pieData = Object.values(catCounts);
        // 8. Recent orders table
        let rows = '';
        orders.slice(0, 10).forEach(order => {
          rows += `<tr>
            <td>${order.order_number}</td>
            <td>${order.product_name}</td>
            <td>${order.customer_fname} ${order.customer_lname}</td>
            <td>${order.quantity}</td>
            <td>${order.order_status}</td>
            <td>${order.date_placed ? order.date_placed.split('T')[0] : ''}</td>
          </tr>`;
        });
        $('#recentOrdersTable').html(rows);
        // Render charts
        renderCharts(barLabels, barData, lineLabels, lineData, pieLabels, pieData);
      } catch (err) {
        $('#recentOrdersTable').html('<tr><td colspan="6" class="text-danger">Failed to load data. Please try again.</td></tr>');
      } finally {
        hideLoading();
      }
    }
    // Render charts
    function renderCharts(barLabels, barData, lineLabels, lineData, pieLabels, pieData) {
      // Destroy previous charts if any
      if (window.barChartObj) window.barChartObj.destroy();
      if (window.lineChartObj) window.lineChartObj.destroy();
      if (window.pieChartObj) window.pieChartObj.destroy();
      // Bar Chart
      window.barChartObj = new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
          labels: barLabels,
          datasets: [{
            label: 'Orders',
            data: barData,
            backgroundColor: 'rgba(139, 92, 42, 0.7)'
          }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
      });
      // Line Chart
      window.lineChartObj = new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
          labels: lineLabels,
          datasets: [{
            label: 'Orders',
            data: lineData,
            fill: false,
            borderColor: 'rgba(166, 124, 82, 0.9)',
            backgroundColor: 'rgba(166, 124, 82, 0.3)',
            tension: 0.3
          }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
      });
      // Pie Chart
      window.pieChartObj = new Chart(document.getElementById('pieChart'), {
        type: 'pie',
        data: {
          labels: pieLabels,
          datasets: [{
            data: pieData,
            backgroundColor: [
              'rgba(139, 92, 42, 0.7)',
              'rgba(166, 124, 82, 0.7)',
              'rgba(255, 206, 86, 0.7)',
              'rgba(75, 192, 192, 0.7)',
              'rgba(153, 102, 255, 0.7)'
            ]
          }]
        },
        options: { responsive: true }
      });
    }
    $(document).ready(loadDashboard);
  </script>

  <!-- Sales Report Generation Script -->
  <script>
  $(document).ready(function() {
    $('#generateReportBtn').on('click', function() {
      showReportPreview();
    });
    
    $('#downloadReportBtn').on('click', function() {
      downloadPDF();
    });
  });

  function showReportPreview() {
    try {
      // Show loading state
      const btn = $('#generateReportBtn');
      btn.html('<i class="fas fa-spinner fa-spin me-2"></i>Generating Preview...').prop('disabled', true);
      
      // Create the report content
      const reportContent = createComprehensiveReport();
      
      // Load content into modal
      $('#reportPreviewContent').html(reportContent);
      
      // Show the modal
      const modal = new bootstrap.Modal(document.getElementById('salesReportModal'));
      modal.show();
      
      // Reset button
      btn.html('<i class="fas fa-download me-2"></i>ðŸ“Š Generate Sales Report').prop('disabled', false);
      
    } catch (error) {
      console.error('Error generating report preview:', error);
      alert('Failed to generate report preview. Please try again.');
      $('#generateReportBtn').html('<i class="fas fa-download me-2"></i>ðŸ“Š Generate Sales Report').prop('disabled', false);
    }
  }

  async function downloadPDF() {
    try {
      // Show loading state on download button
      const downloadBtn = $('#downloadReportBtn');
      downloadBtn.html('<i class="fas fa-spinner fa-spin me-2"></i>Generating PDF...').prop('disabled', true);
      
      // Get the report content from the modal
      const reportContent = $('#reportPreviewContent').html();
      
      // Create a temporary container for PDF generation
      const tempContainer = $('<div>').addClass('pdf-container');
      tempContainer.html(reportContent);
      
      // Style the container for PDF
      tempContainer.css({
        'position': 'absolute',
        'left': '-9999px',
        'top': '0',
        'width': '800px',
        'padding': '20px',
        'backgroundColor': 'white',
        'color': 'black',
        'fontFamily': 'Arial, sans-serif',
        'fontSize': '12px',
        'lineHeight': '1.4',
        'border': '1px solid #ccc'
      });
      
      // Add to body
      $('body').append(tempContainer);
      
      // Wait for content to render
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      // Use html2canvas to capture the content
      const canvas = await html2canvas(tempContainer[0], {
        scale: 2,
        useCORS: true,
        allowTaint: true,
        backgroundColor: '#ffffff',
        width: 800,
        height: tempContainer[0].scrollHeight,
        scrollX: 0,
        scrollY: 0
      });
      
      // Create PDF using jsPDF
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p', 'mm', 'a4');
      
      // Calculate dimensions
      const imgWidth = 210; // A4 width in mm
      const pageHeight = 295; // A4 height in mm
      const imgHeight = (canvas.height * imgWidth) / canvas.width;
      let heightLeft = imgHeight;
      
      let position = 0;
      
      // Add image to PDF
      pdf.addImage(canvas, 'JPEG', 0, position, imgWidth, imgHeight);
      heightLeft -= pageHeight;
      
      // Add additional pages if needed
      while (heightLeft >= 0) {
        position = heightLeft - imgHeight;
        pdf.addPage();
        pdf.addImage(canvas, 'JPEG', 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
      }
      
      // Save the PDF
      const filename = `sales_report_${$('#sellerName').text()}_${new Date().toISOString().split('T')[0]}.pdf`;
      pdf.save(filename);
      
      // Clean up
      tempContainer.remove();
      console.log('PDF generated successfully');
      
      // Close modal after successful download
      const modal = bootstrap.Modal.getInstance(document.getElementById('salesReportModal'));
      modal.hide();
      
    } catch (error) {
      console.error('Error downloading PDF:', error);
      alert('Failed to download PDF. Please try again. Error: ' + error.message);
    } finally {
      // Reset download button
      $('#downloadReportBtn').html('<i class="fas fa-download me-2"></i>Download PDF').prop('disabled', false);
    }
  }

  function createComprehensiveReport() {
    // Get current dashboard data
    const totalProducts = $('#totalProducts').text();
    const totalOrders = $('#totalOrders').text();
    const mostOrderedProduct = $('#mostOrderedProduct').text();
    const sellerName = $('#sellerName').text();
    
    // Get recent orders data
    const ordersData = [];
    $('#recentOrdersTable tr').each(function() {
      const cells = $(this).find('td');
      if (cells.length > 0) {
        ordersData.push({
          orderNumber: $(cells[0]).text(),
          product: $(cells[1]).text(),
          customer: $(cells[2]).text(),
          quantity: $(cells[3]).text(),
          status: $(cells[4]).text(),
          date: $(cells[5]).text()
        });
      }
    });

    // Calculate total revenue from orders
    let totalRevenue = 0;
    ordersData.forEach(order => {
      // Assuming each order has a value, you might need to adjust this calculation
      totalRevenue += parseInt(order.quantity) * 1000; // Placeholder calculation
    });

    // Get chart data from the dashboard
    let barChartData = [];
    let lineChartData = [];
    let pieChartData = [];

    // Try to get data from existing charts
    if (window.barChartObj && window.barChartObj.data) {
      barChartData = window.barChartObj.data.labels.map((label, index) => ({
        label: label,
        value: window.barChartObj.data.datasets[0].data[index]
      }));
    }

    if (window.lineChartObj && window.lineChartObj.data) {
      lineChartData = window.lineChartObj.data.labels.map((label, index) => ({
        label: label,
        value: window.lineChartObj.data.datasets[0].data[index]
      }));
    }

    if (window.pieChartObj && window.pieChartObj.data) {
      pieChartData = window.pieChartObj.data.labels.map((label, index) => ({
        label: label,
        value: window.pieChartObj.data.datasets[0].data[index]
      }));
    }

    return `
      <div style="text-align: center; margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
        <h1 style="color: #8B5C2A; margin-bottom: 10px; font-size: 24px;">HomeHaven Sales Report</h1>
        <h2 style="color: #7a6242; margin-bottom: 20px; font-size: 18px;">${sellerName}'s Business Dashboard</h2>
        <p style="color: #666; font-size: 12px;">Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>
      </div>

      <div style="margin-bottom: 30px;">
        <h3 style="color: #8B5C2A; border-bottom: 2px solid #8B5C2A; padding-bottom: 5px; font-size: 16px;">Business Overview</h3>
        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
          <tr style="background-color: #f5f3f0;">
            <th style="padding: 8px; border: 1px solid #ddd; text-align: left; color: black;">Metric</th>
            <th style="padding: 8px; border: 1px solid #ddd; text-align: left; color: black;">Value</th>
          </tr>
          <tr>
            <td style="padding: 8px; border: 1px solid #ddd; color: black; font-weight: bold;">Total Products</td>
            <td style="padding: 8px; border: 1px solid #ddd; color: black;">${totalProducts}</td>
          </tr>
          <tr>
            <td style="padding: 8px; border: 1px solid #ddd; color: black; font-weight: bold;">Total Orders</td>
            <td style="padding: 8px; border: 1px solid #ddd; color: black;">${totalOrders}</td>
          </tr>
          <tr>
            <td style="padding: 8px; border: 1px solid #ddd; color: black; font-weight: bold;">Most Ordered Product</td>
            <td style="padding: 8px; border: 1px solid #ddd; color: black;">${mostOrderedProduct}</td>
          </tr>
          <tr style="background-color: #e8f5e8;">
            <td style="padding: 8px; border: 1px solid #ddd; color: black; font-weight: bold;">Total Revenue</td>
            <td style="padding: 8px; border: 1px solid #ddd; color: black; font-weight: bold;">â‚±${totalRevenue.toLocaleString()}</td>
          </tr>
        </table>
      </div>

      <div style="margin-bottom: 30px;">
        <h3 style="color: #8B5C2A; border-bottom: 2px solid #8B5C2A; padding-bottom: 5px; font-size: 16px;">Chart Analysis</h3>
        
        <div style="display: flex; justify-content: space-between; margin-top: 15px;">
          <div style="width: 48%; text-align: center; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
            <h4 style="color: #8B5C2A; margin-bottom: 10px;">Orders per Product</h4>
            ${barChartData.length > 0 ? `
              <div style="background: #f8f9fa; border-radius: 5px; padding: 10px;">
                ${barChartData.map(item => `
                  <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px; background: white; border-radius: 3px;">
                    <span style="font-weight: bold;">${item.label}</span>
                    <span style="color: #8B5C2A; font-weight: bold;">${item.value}</span>
                  </div>
                `).join('')}
              </div>
            ` : `
              <div style="height: 200px; background: #f8f9fa; border-radius: 5px; display: flex; align-items: center; justify-content: center; color: #666;">
                <p>No chart data available</p>
              </div>
            `}
          </div>
          
          <div style="width: 48%; text-align: center; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
            <h4 style="color: #8B5C2A; margin-bottom: 10px;">Orders Over Time</h4>
            ${lineChartData.length > 0 ? `
              <div style="background: #f8f9fa; border-radius: 5px; padding: 10px;">
                ${lineChartData.map(item => `
                  <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px; background: white; border-radius: 3px;">
                    <span style="font-weight: bold;">${item.label}</span>
                    <span style="color: #8B5C2A; font-weight: bold;">${item.value}</span>
                  </div>
                `).join('')}
              </div>
            ` : `
              <div style="height: 200px; background: #f8f9fa; border-radius: 5px; display: flex; align-items: center; justify-content: center; color: #666;">
                <p>No chart data available</p>
              </div>
            `}
          </div>
        </div>
        
        <div style="margin-top: 15px; text-align: center; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
          <h4 style="color: #8B5C2A; margin-bottom: 10px;">Product Category Distribution</h4>
          ${pieChartData.length > 0 ? `
            <div style="background: #f8f9fa; border-radius: 5px; padding: 10px;">
              ${pieChartData.map(item => `
                <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px; background: white; border-radius: 3px;">
                  <span style="font-weight: bold;">${item.label}</span>
                  <span style="color: #8B5C2A; font-weight: bold;">${item.value}</span>
                </div>
              `).join('')}
            </div>
          ` : `
            <div style="height: 200px; background: #f8f9fa; border-radius: 5px; display: flex; align-items: center; justify-content: center; color: #666;">
              <p>No chart data available</p>
            </div>
          `}
        </div>
      </div>

      <div style="margin-bottom: 30px;">
        <h3 style="color: #8B5C2A; border-bottom: 2px solid #8B5C2A; padding-bottom: 5px; font-size: 16px;">Recent Orders History</h3>
        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
          <tr style="background-color: #f5f3f0;">
            <th style="padding: 8px; border: 1px solid #ddd; text-align: left; color: black;">Order #</th>
            <th style="padding: 8px; border: 1px solid #ddd; text-align: left; color: black;">Product</th>
            <th style="padding: 8px; border: 1px solid #ddd; text-align: left; color: black;">Customer</th>
            <th style="padding: 8px; border: 1px solid #ddd; text-align: left; color: black;">Quantity</th>
            <th style="padding: 8px; border: 1px solid #ddd; text-align: left; color: black;">Status</th>
            <th style="padding: 8px; border: 1px solid #ddd; text-align: left; color: black;">Date</th>
          </tr>
          ${ordersData.length > 0 ? ordersData.map(order => `
            <tr>
              <td style="padding: 8px; border: 1px solid #ddd; color: black;">${order.orderNumber}</td>
              <td style="padding: 8px; border: 1px solid #ddd; color: black;">${order.product}</td>
              <td style="padding: 8px; border: 1px solid #ddd; color: black;">${order.customer}</td>
              <td style="padding: 8px; border: 1px solid #ddd; color: black;">${order.quantity}</td>
              <td style="padding: 8px; border: 1px solid #ddd; color: black;">${order.status}</td>
              <td style="padding: 8px; border: 1px solid #ddd; color: black;">${order.date}</td>
            </tr>
          `).join('') : `
            <tr>
              <td colspan="6" style="padding: 8px; border: 1px solid #ddd; color: black; text-align: center;">No orders found</td>
            </tr>
          `}
        </table>
      </div>

      <div style="margin-bottom: 30px;">
        <h3 style="color: #8B5C2A; border-bottom: 2px solid #8B5C2A; padding-bottom: 5px; font-size: 16px;">Performance Summary</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
          <div style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; text-align: center;">
            <h4 style="color: #8B5C2A; margin-bottom: 5px;">Top Selling Products</h4>
            <p style="color: #666; font-size: 12px;">Based on order frequency and quantity</p>
            ${barChartData.length > 0 ? `
              <div style="margin-top: 10px;">
                <p style="font-weight: bold; color: #8B5C2A;">${barChartData[0]?.label || 'N/A'}</p>
                <p style="font-size: 12px; color: #666;">${barChartData[0]?.value || 0} orders</p>
              </div>
            ` : '<p style="color: #666; font-size: 12px;">No data available</p>'}
          </div>
          <div style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; text-align: center;">
            <h4 style="color: #8B5C2A; margin-bottom: 5px;">Revenue Trends</h4>
            <p style="color: #666; font-size: 12px;">Monthly and quarterly performance</p>
            <p style="font-weight: bold; color: #8B5C2A; margin-top: 10px;">â‚±${totalRevenue.toLocaleString()}</p>
            <p style="font-size: 12px; color: #666;">Total Revenue</p>
          </div>
        </div>
      </div>

      <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 2px solid #8B5C2A;">
        <p style="color: #666; font-size: 10px;">This report was generated automatically by HomeHaven Seller Dashboard</p>
        <p style="color: #666; font-size: 10px;">For detailed analytics, visit your dashboard at HomeHaven</p>
      </div>
    `;
  }
  </script>
</body>
</html> 